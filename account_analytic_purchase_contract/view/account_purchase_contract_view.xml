<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
        <record id="view_purchase_contract_form" model="ir.ui.view">
            <field name="name">purchase.contract.form</field>
            <field name="model">account.analytic.account</field>
            <field name="arch" type="xml">
                <form string="Analytic Account">
                    <sheet string="Analytic Account">
                        <div class="oe_right oe_button_box" name="buttons">
                        </div>

                        <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                            <h1>
                                <field name="name" class="oe_inline"/>
                            </h1>
                            <div name="project"/>
                        </div>

                        <group name="main">
                            <group>
                                <field name="partner_id" on_change="on_change_partner_id(partner_id, name)" string="Supplier"/>
                                <field name="manager_id" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'account.group_account_manager']}"/>
                                <field name="currency_id" attrs="{'invisible': ['|',('type', '&lt;&gt;', 'view'), ('company_id', '&lt;&gt;', False)]}"/>
                            </group>
                            <group>
                                <field name="type" invisible="context.get('default_type', False)"/>
                                <field name="template_id" on_change="on_change_template(template_id, date_start)" domain="[('type','=','template')]" attrs="{'invisible': [('type','in',['view', 'normal','template'])]}" context="{'default_type' : 'template'}"/>
                                <field name="code"/>
                                <field name="parent_id" on_change="on_change_parent(parent_id)" attrs="{'invisible': [('type','in',['contract'])]}"/>
                                <field name="company_id" on_change="on_change_company(company_id)" widget="selection" groups="base.group_multi_company" attrs="{'required': [('type','&lt;&gt;','view')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Contract Information" name="contract_page" attrs="{'invisible':[('type','not in',['contract', 'template', 'purchase_contract'])]}">
                                <group string="Renewal" name="contract">
                                    <p colspan="2" class="oe_grey oe_edit_only">
                                        Once the end date of the contract is
                                        passed or the maximum number of service
                                        units (e.g. support contract) is
                                        reached, the account manager is notified 
                                        by email to renew the contract with the
                                        customer.
                                    </p>
                                    <field name="date_start"/>
                                    <label for="date" string="End Date"/>
                                    <div name="duration">
                                        <field name="date" class="oe_inline"/>
                                    </div>
                                </group>
                                 <!-- <separator name="toinvoice" string="Invoicing"/>
                    <table class="oe_form_analytic_account">
                        <tr>
                            <th class="oe_timesheet_grey" width="160px"/>
                            <th class="oe_timesheet_grey" width="25px"/>
                            <th class="oe_timesheet_grey" width="100px"><label string="Expected"/></th>
                            <th class="oe_timesheet_grey" width="100px"><label string="Invoiced"/></th>
                            <th class="oe_timesheet_grey" width="100px"><label string="Remaining"/></th>
                            <th class="oe_timesheet_grey" width="100px"><label string="To Invoice"/></th>
                            <th width="30px"/>
                            <th/>
                        </tr><tr>
                            <td class="oe_timesheet_grey">
                                <label for="fix_price_invoices"/>
                            </td><td class="oe_timesheet_grey">
                                <field name="fix_price_invoices" class="oe_inline"/>
                            </td><td>
                                <field class="oe_inline" name="amount_max" attrs="{'invisible': [('fix_price_invoices','=',False)]}"/>
                            </td><td>
                                <field class="oe_inline" name="ca_invoiced" attrs="{'invisible': [('fix_price_invoices','=',False)]}"/>
                            </td><td>
                                <field class="oe_inline" name="remaining_ca" attrs="{'invisible': [('fix_price_invoices','=',False)]}"/>
                            </td><td>
                                <field class="oe_inline" name="fix_price_to_invoice" attrs="{'invisible': [('fix_price_invoices','=',False)]}"/>
                            </td><td attrs="{'invisible': [('fix_price_invoices','=',False)]}" class="oe_timesheet_action">
                                <span attrs="{'invisible': [('fix_price_to_invoice','=',0.0)]}" class="oe_grey">
                                    <button name="open_sale_order_lines" class="oe_link" string="⇒ Invoice" type="object" context="{'default_partner_id': [partner_id],'default_project_id': active_id,'search_default_uninvoiced': 1,'search_default_project_id': active_id,'search_default_partner_id': [partner_id]}"/>
                                    or view
                                </span>

                                <span attrs="{'invisible': [('fix_price_to_invoice','&lt;&gt;',0.0 )]}" class="oe_grey">
                                    No order to invoice, create
                                </span>
                                <button name="484" string="Sales Orders" type="action" class="oe_link" context="{'default_partner_id': [partner_id], 'search_default_project_id': [active_id],'default_project_id': [active_id]}"/>
                            </td>
                        </tr><tr>
                            <td class="oe_timesheet_grey">
                                <label for="invoice_on_timesheets"/>
                            </td><td class="oe_timesheet_grey">
                                <field name="invoice_on_timesheets" on_change="onchange_invoice_on_timesheets(invoice_on_timesheets)"/>
                            </td><td>
                                <field class="oe_inline" name="hours_qtt_est" attrs="{'invisible': [('invoice_on_timesheets','=',False)]}"/>
                            </td><td>
                                <field class="oe_inline" name="timesheet_ca_invoiced" attrs="{'invisible': [('invoice_on_timesheets','=',False)]}"/>
                            </td><td>
                                <field class="oe_inline" name="remaining_hours_to_invoice" attrs="{'invisible': [('invoice_on_timesheets','=',False)]}"/>
                            </td><td>
                                <field class="oe_inline" name="ca_to_invoice" attrs="{'invisible': [('invoice_on_timesheets','=',False)]}"/>
                            </td><td class="oe_timesheet_action" attrs="{'invisible': ['|',('invoice_on_timesheets','=',False),('type','=','template')]}">
                                <span attrs="{'invisible': [('ca_to_invoice','=',0.0)]}" class="oe_grey">
                                    <button name="hr_to_invoice_timesheets" type="object" class="oe_link" string="⇒ Invoice"/>
                                    or view 
                                </span>
                                <span attrs="{'invisible': [('ca_to_invoice','&lt;&gt;',0.0)]}" class="oe_grey">
                                    Nothing to invoice, create 
                                </span>

                                <button name="417" string="Timesheets" type="action" class="oe_link" context="{'default_account_id': active_id,'search_default_account_id': active_id}"/>
                            </td>
                        </tr><tr name="total">
                            <th class="oe_timesheet_grey">
                                <label string="Total"/>
                            </th><td class="oe_timesheet_grey">
                            </td><td class="oe_timesheet_grey">
                                <field name="est_total" class="oe_inline" attrs="{'invisible': [('invoice_on_timesheets','=',False)]}"/>
                            </td><td class="oe_timesheet_grey">
                                <field name="invoiced_total" class="oe_inline"/>
                            </td><td class="oe_timesheet_grey">
                                <field name="remaining_total" class="oe_inline"/>
                            </td><td class="oe_timesheet_grey">
                                <field name="toinvoice_total" class="oe_inline"/>
                            </td><td>
                            </td>
                        </tr>
                    </table>
                    <group name="invoice_on_timesheets">
                        <p name="invoice_on_timesheets_label" class="oe_grey oe_edit_only" colspan="2" attrs="{'invisible': [('invoice_on_timesheets','=',False)]}">
                            When reinvoicing costs, Odoo uses the
                            pricelist of the contract which uses the price
                            defined on the product related (e.g timesheet 
                            products are defined on each employee). 
                        </p>
                        <group>
                            <field name="pricelist_id" class="oe_inline" attrs="{'required': [('invoice_on_timesheets', '=', True)]}" domain="[('type', '=', 'sale')]"/>
                            <field name="to_invoice" class="oe_inline" widget="selection" attrs="{'required': [('invoice_on_timesheets', '=', True)], 'invisible': [('invoice_on_timesheets','=',False)]}"/>
                        </group>
                    </group> -->
                    <separator string="Recurring Invoices" attrs="{'invisible': [('recurring_invoices','!=',True)]}"/>
                    <div>
                        <div attrs="{'invisible': [('type','!=', 'purchase_contract')]}">
                            <field name="recurring_invoices" on_change="onchange_recurring_invoices(recurring_invoices, date_start)" class="oe_inline"/>
                            <label for="recurring_invoices"/>
                        </div>
                        <button class="oe_link" name="recurring_create_invoice" attrs="{'invisible': [('recurring_invoices','!=',True)]}" string="⇒ create invoices" type="object" groups="base.group_no_one"/>
                    </div>
                    <group attrs="{'invisible': [('recurring_invoices','!=',True)]}">
                        <label for="recurring_interval"/>
                        <div>
                            <field name="recurring_interval" class="oe_inline" attrs="{'required': [('recurring_invoices', '=', True)]}"/>
                            <field name="recurring_rule_type" class="oe_inline" attrs="{'required': [('recurring_invoices', '=', True)]}"/>
                        </div>
                        <field name="recurring_next_date"/>
                    </group>
                    <label for="recurring_invoice_line_ids" attrs="{'invisible': [('recurring_invoices','=',False)]}"/>
                    <div attrs="{'invisible': [('recurring_invoices','=',False)]}">
                        <field name="recurring_invoice_line_ids">
                            <tree string="Account Analytic Lines" editable="bottom">
                                <field name="product_id" on_change="product_id_change(product_id, uom_id, quantity, False, parent.partner_id, False, parent.pricelist_id, parent.company_id)"/>
                                <field name="name"/>
                                <field name="quantity"/>
                                <field name="uom_id"/>
                                <field name="price_unit"/>
                                <field name="price_subtotal"/>
                            </tree>
                        </field>
                    </div>
                                <separator string="Terms and Conditions" name="description"/>
                                <field name="description"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>


        <record id="view_purchase_contract" model="ir.ui.view">
            <field name="name">purchase_contract.tree</field>
            <field name="model">account.analytic.account</field>
            <field name="inherit_id" ref="account.view_account_analytic_account_list"/>
            <field name="arch" type="xml">

            <field name="partner_id" position="attributes">
            <attribute name="invisible">'recurring_invoices' in context</attribute>
        </field>
                <field name="partner_id" position="after" >
                    <field string="Supplier" name="partner_id" invisible="'recurring_invoices' not in context"/>
                    
                </field>



            </field>
        </record>
	</data>
</openerp>
